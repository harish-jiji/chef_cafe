<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu - Chef's cafe</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="images/logo.jpg" alt="Chef's cafe Logo">
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                </li>
                <li class="nav-item">
                    <a href="menu.html" class="nav-link active">Menu</a>
                </li>
                <li class="nav-item">
                    <a href="index.html#contact" class="nav-link">Contact</a>
                </li>
            </ul>
            <div class="nav-controls">
                <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Menu Header -->
    <section class="menu-header">
        <div class="container">
            <h1>Our Menu</h1>
            <p>Discover our delicious selection of dishes crafted with love and fresh ingredients</p>
        </div>
    </section>

    <!-- Menu Categories -->
    <section class="menu-categories">
        <div class="container">
            <!-- Search Bar -->
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchInput" placeholder="Search for dishes..." aria-label="Search menu items">
            </div>

            <!-- Mobile category dropdown -->
            <div class="category-select-wrapper">
                <select id="categorySelect" class="category-select" aria-label="Select menu category">
                    <option value="all" selected>All Items</option>
                </select>
            </div>

            <div class="category-nav">
                <button class="category-btn active" data-category="all">All Items</button>
            </div>
        </div>
    </section>

    <!-- Menu Items -->
    <section class="menu-items">
        <div class="container">
            <div id="menu-container">

                <!-- Categories and items will be loaded dynamically here -->

            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <img src="images/logo.jpg" alt="Chef's cafe Logo">
                    </div>
                    <p>Experience the finest flavors at Chef's cafe, where every dish tells a story of passion and
                        quality.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="menu.html">Menu</a></li>
                        <li><a href="index.html#contact">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Chef's cafe. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Firebase core -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAON6aij8dNG0RLJ1DdlcwMkPZsAGe-SBQ",
            authDomain: "chef-s-cafe.firebaseapp.com",
            projectId: "chef-s-cafe",
            storageBucket: "chef-s-cafe.firebasestorage.app",
            messagingSenderId: "623426909086",
            appId: "1:623426909086:web:6c0d2a83cb04d6125b5c8f"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <script>
        // Use a global variable to store category buttons and sections after they are created
        let dynamicCategoryBtns = [];
        let dynamicMenuSections = [];

        // DYNAMIC CATEGORY LOADING
        const categoryQuery = db.collection("categories").orderBy("order");

        categoryQuery.onSnapshot(catSnap => {
            const nav = document.querySelector(".category-nav");
            const mobileSelect = document.getElementById("categorySelect");
            const container = document.getElementById("menu-container");

            // Reset
            nav.innerHTML = '<button class="category-btn active" data-category="all">All Items</button>';
            mobileSelect.innerHTML = '<option value="all" selected>All Items</option>';
            container.innerHTML = "";

            catSnap.forEach(catDoc => {
                const cat = catDoc.data();

                // Add to Nav
                const catId = cat.name.toLowerCase().replace(/\s+/g, '-');
                nav.innerHTML += `<button class="category-btn" data-category="${cat.name}">${cat.name}</button>`;

                // Add to Mobile Select
                mobileSelect.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;

                container.innerHTML += `
                    <div class="menu-section" id="${cat.name}">
                        <h2 class="menu-section-title">${cat.name}</h2>
                        <div class="menu-grid"></div>
                    </div>
                `;
            });

            // Re-bind listeners
            bindDynamicListeners();
            loadMenuItems();
        });

        function bindDynamicListeners() {
            const btns = document.querySelectorAll('.category-btn');
            const sections = document.querySelectorAll('.menu-section');
            const select = document.getElementById('categorySelect');

            function filter(category) {
                sections.forEach(sec => {
                    if (category === 'all' || sec.id === category) {
                        sec.style.display = 'block';
                    } else {
                        sec.style.display = 'none';
                    }
                });
            }

            btns.forEach(btn => {
                btn.addEventListener('click', () => {
                    btns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const cat = btn.getAttribute('data-category');
                    filter(cat);
                    if (select) select.value = cat;
                });
            });

            if (select) {
                select.addEventListener('change', (e) => {
                    const cat = e.target.value;
                    filter(cat);
                    btns.forEach(b => b.classList.toggle('active', b.getAttribute('data-category') === cat));
                    const target = cat === 'all' ? document.querySelector('.menu-items') : document.getElementById(cat);
                    if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            }
        }

        function loadMenuItems() {
            db.collection("menu_items").onSnapshot(snapshot => {
                // Clear existing grids before refilling
                document.querySelectorAll(".menu-grid").forEach(grid => grid.innerHTML = "");

                snapshot.forEach(doc => {
                    const item = doc.data();

                    const section = document.getElementById(item.category);
                    if (!section) return;

                    const grid = section.querySelector(".menu-grid");

                    grid.innerHTML += `
                        <div class="menu-item">
                            <div class="menu-item-content">
                                <h3>${item.name}</h3>
                            </div>
                            <div class="menu-price">₹${item.price}</div>
                        </div>
                    `;
                });
            });
        }
    </script>

    <script src="js/script.js"></script>
</body>

</html>